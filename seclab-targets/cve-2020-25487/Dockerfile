FROM puppeteer1337/php7

ENV TZ=America/Los_Angeles
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
RUN apt-get update
RUN apt-get install --yes python3 python3-pip software-properties-common apache2 mysql-server mysql-client

COPY zms/zms /var/www/html/zms
RUN chown -R www-data:www-data /var/www/html/zms
COPY zms/zms.sql /tmp/zms.sql
COPY init.sh /tmp/init.sh
COPY exploit.py /exploit.py

WORKDIR /home/wc
COPY lib_mysqludf_sys/install.sh lib_mysqludf_sys/lib_mysqludf_sys.sql ./
COPY lib_mysqludf_sys/lib_mysqludf_sys.so /usr/lib/mysql/plugin/
RUN chmod 500 install.sh
RUN bash install.sh

EXPOSE 80
RUN bash /tmp/init.sh
CMD ["supervisord"]
