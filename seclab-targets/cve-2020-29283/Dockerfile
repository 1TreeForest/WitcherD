FROM puppeteer1337/wphp7-mysqli
MAINTAINER sherlock

ENV TZ=America/Los_Angeles
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
# RUN apt-get purge `dpkg -l | grep php| awk '{print $2}' |tr "\n" " "`
RUN apt-get update
RUN apt-get install --yes python3 python3-pip software-properties-common apache2 mysql-server mysql-client
# RUN add-apt-repository ppa:ondrej/php
# RUN apt-get update
# RUN apt-get install --yes php5.6 libapache2-mod-php5.6 php5.6-mysql
# RUN a2enmod php5.6
RUN pip3 install requests

COPY das /var/www/html/das
RUN chown -R www-data:www-data /var/www/html/das
COPY das/das.sql /tmp/das.sql
COPY init.sh /tmp/init.sh
COPY exploit.py /exploit.py

WORKDIR /home/wc
COPY lib_mysqludf_sys/install.sh lib_mysqludf_sys/lib_mysqludf_sys.sql ./
COPY lib_mysqludf_sys/lib_mysqludf_sys.so /usr/lib/mysql/plugin/
RUN chmod 500 install.sh
RUN bash install.sh

EXPOSE 80
RUN bash "/tmp/init.sh"
CMD ["supervisord"]
