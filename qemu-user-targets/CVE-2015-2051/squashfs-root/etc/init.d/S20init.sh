#!/bin/sh
image_sign=`cat /etc/config/image_sign`
mkdir -p /var/servd
xmldb -d -n $image_sign -t > /dev/console 
servd -d schedule_off > /dev/console 2>&1 &
/etc/scripts/dbload.sh
service LOGD start
echo "1" > /proc/sys/kernel/panic

#some firewall will block this
echo "0" > /proc/sys/net/ipv4/tcp_timestamps

# this mean dirty data will be write out after one sec.
# this can help write data to disk ASAP before user unplug usb drive.
# and no need to mount with sync option.
echo 100 > /proc/sys/vm/dirty_expire_centisecs

# When xmldb die then system will fall into abnormal state. So, reboot device.
xmldb_pid=`cat /var/run/xmldb_sock_*`
if [ "$xmldb_pid" != "" ]; then 
	pidmon $xmldb_pid add "echo \"xmldb die, reboot device\";sleep 5;reboot" 10
fi

exit 0
