function Datalist(){this.list=new Array();this.maxrowid=0}Datalist.prototype={get length(){return this.list.length},set length(a){if(parseInt(a,10)>=0){this.list.length=parseInt(a,10)}}};Datalist.prototype.getData=function(b){var a;var c;for(a=0;a<this.list.length;a++){c=this.list[a];if(c.rowid==b){break}}return c};Datalist.prototype.getDataRowNumByMac=function(e){var b;var c=null;var d=null;var a=e.toLowerCase();for(b=0;b<this.list.length;b++){c=this.list[b];if(c.MacAddress.toLowerCase()==a){d=b;break}}return d};Datalist.prototype.getRowNum=function(a){var b=0;for(b=0;b<this.list.length;b++){if(a==this.list[b].rowid){break}}return b};Datalist.prototype.editData=function(c,a){var b=this.getRowNum(c);this.list[b].IPv4Address=a.IPv4Address;this.list[b].IPv6Address=a.IPv6Address;this.list[b].Type=a.Type;this.list[b].DeviceName=a.DeviceName;this.list[b].NickName=a.NickName;this.list[b].ReserveIP=a.ReserveIP;this.list[b].Vendor=a.Vendor;this.list[b].ScheduleName=a.ScheduleName;this.list[b].MacfilterEnabled=a.MacfilterEnabled;this.list[b].Status=a.Status;return true};Datalist.prototype.deleteData=function(b){var a=this.getRowNum(b);this.list.splice(a,1)};Datalist.prototype.push=function(a){a.setRowid(this.maxrowid);this.list.push(a);this.maxrowid++;return true};function Data(d,g,e,c,b,f,a){this.MacAddress=d;this.IPv4Address=g;this.IPv6Address=e;this.Type=c;this.DeviceName=b;this.NickName=f;this.ReserveIP=a;this.Vendor=getVendor(d);this.ScheduleName;this.MacfilterEnabled=false;this.Status=false}Data.prototype={get NickName(){if(this._NickName==""){return this.DeviceName}return this._NickName},set NickName(a){this._NickName=a;if(a==this.DeviceName){this._NickName=""}},setRowid:function(a){this.rowid=a},showClientInfo:function(){var a=this;var c=a.NickName;var f="";var e;var b="link_IconE_";if(typeof(a.MacAddress)=="undefined"||a.MacAddress.length==0){return""}if(c==""){c="Unknown"}var g=a.Type.toUpperCase();if(g=="WIFI_2.4G"||g=="WIFI_5G"||g=="WIFI_2.4G_GUEST"||g=="WIFI_5G_GUEST"){b="link_IconW_"}if(a.MacfilterEnabled){f=I18N("j","Enabled");e="#FF0000";if((a.Type=="Blocked")||(a.Status)){b+="Block"}else{b+="Allow"}}else{f=I18N("j","Disabled");e="#000000";b+="Allow"}var d='<td><div class ="client_Tag" style ="cursor:default"><div class ="'+b+'"></div><div class ="client_Info"><div class ="client_Name">'+c+'</div><div class ="client_EditImage" onclick ="editData('+a.rowid+')" style ="cursor:pointer"></div><div class ="client_Vender">'+a.Vendor+'</div><div class ="client_IPv4Address">'+a.IPv4Address+'</div><div class ="client_IPv6Address" id="IPv6Address_Client_'+a.rowid+'" title="'+a.IPv6Address+'">'+a.IPv6Address+'</div><div class ="client_Access">'+I18N("j","Parental Control")+': <font color ="'+e+'">'+f+"</font></div></div></div></td>";return d}};var tmpXML_ScheduleCnt;var Client_Type="Host";var datalist=new Datalist();function getVendor(f){var d=f.split(":");var b=d[0]+d[1]+d[2];var e="Unknown Vendor";b=b.toUpperCase();var a=allText.indexOf(b);if(a>=0){a+=7;var c=allText.substring(a).split(/[\s,]+/);e=decode_char_text(c[0])}return e}function Get_ClientInfo(){var b=$.Deferred();var g=new SOAPGetClientInfoResponse();var f=new SOAPGetMACFilters2Response();var c=new SOAPAction();var e=new SOAPAction();var a=c.sendSOAPAction("GetClientInfo",null,g);var d=null;if(currentState=="clientInfo"){d=e.sendSOAPAction("GetMACFilters2",null,f)}$.when(a,d).done(function(k){for(var p in datalist.list){var k=datalist.list[p];var q=false;if(k.Type=="Blocked"){continue}for(var h in g.ClientInfoLists.ClientInfo){var i=g.ClientInfoLists.ClientInfo[h];if(i.MacAddress.toLowerCase()==k.MacAddress.toLowerCase()){q=true;break}}if(q==false){datalist.deleteData(k.rowid)}}for(var h in g.ClientInfoLists.ClientInfo){var i=g.ClientInfoLists.ClientInfo[h];var l=new Data(i.MacAddress,i.IPv4Address,i.IPv6Address,i.Type,i.DeviceName,i.NickName,i.ReserveIP);var o=datalist.getDataRowNumByMac(i.MacAddress);if(o!=null){datalist.editData(datalist.list[o].rowid,l)}else{datalist.push(l)}}if(currentState=="clientInfo"){var m=false;for(var p in datalist.list){var k=datalist.list[p];var q=false;if(k.Type!="Blocked"){continue}for(var j in f.MACList.MACInfo){var n=f.MACList.MACInfo[j];if(n.MacAddress.toLowerCase()==k.MacAddress.toLowerCase()){q=true;break}}if(q==false){datalist.deleteData(k.rowid)}}for(var j in f.MACList.MACInfo){var n=f.MACList.MACInfo[j];var o=datalist.getDataRowNumByMac(n.MacAddress);if(o!=null){datalist.list[o].MacfilterEnabled=true;datalist.list[o].ScheduleName=n.ScheduleName;if(n.Status=="true"){datalist.list[o].Status=true}}else{var l=new Data(n.MacAddress,"","","LAN",n.DeviceName,"","");l.MacfilterEnabled=true;l.ScheduleName=n.ScheduleName;l.Type="Blocked";if(n.Status=="true"){l.Status=true}datalist.push(l);m=true}}showClientTypeBtn("block",m);showClientLists(Client_Type)}$("#Total_ConnectedClients").html(g.ClientInfoLists.ClientInfo.length);b.resolve()});return b.promise()}function showClientLists(c){$(document).tooltip("disable");$(document).tooltip("enable");var b=0;var a="<tr>";for(var e in datalist.list){var d=datalist.list[e];if(c=="Guest"){if(d.Type.toLowerCase().indexOf("guest")<0){continue}}else{if(c=="Host"){if(d.Type.toLowerCase().indexOf("guest")>=0){continue}if(d.Type=="Blocked"){continue}}else{if(c=="Blocked"){if(d.Type!="Blocked"){continue}}}}b++;a+=d.showClientInfo();if(b%3==0){a+="</tr><tr>"}}a+="</tr>";$("#Client_items").html(a);if(b>0){$("#Client_Info").hide()}else{if(c=="Blocked"){showClientTypeBtn("block",false);showClientLists("Host")}else{$("#Client_Info").show()}}$("#Client_Group").css("display","table-row")}function editData(d){$("#editPop").show();$("#check_btn").attr("class","styled_button_dis").attr("disabled",true).off("click").click(function(){closeEditPOP(d)});var c=datalist.getData(d);var a=c.IPv4Address;document.getElementById("IPAdrReserve_Info").innerHTML="";document.getElementById("client_IPAdrReserve").value=c.ReserveIP;document.getElementById("client_MACAddress").innerHTML=c.MacAddress;$("#client_Name").val(c.NickName);if(a==""){a=I18N("j","Not Available")}$("#client_IPAdr").html(a);if(c.ReserveIP==""){document.getElementById("show_IPAdrReserve").style.display="none";document.getElementById("show_IPAdr").style.display="table-row";presetCheckBox("enableReserveIP",false)}else{document.getElementById("show_IPAdrReserve").style.display="table-row";document.getElementById("show_IPAdr").style.display="none";presetCheckBox("enableReserveIP",true)}if(c.Vendor!=""){document.getElementById("client_Vendor").innerHTML=c.Vendor}else{document.getElementById("client_Vendor").innerHTML="N/A"}if(c.MacfilterEnabled==false){presetCheckBox("enableAccess",false);document.getElementById("show_Schedule").style.display="none"}else{presetCheckBox("enableAccess",true);document.getElementById("show_Schedule").style.display="table-row";$("#schedule").selectbox("detach");$("#schedule").val("Always");if(c.ScheduleName!=""){for(var b=1;b<=tmpXML_ScheduleCnt;b++){if(schedule.options[b].value===c.ScheduleName){$("#schedule").val(schedule.options[b].value);break}}}$("#schedule").selectbox("attach")}}function closeEditPOP(b){var h=document.getElementById("enableReserveIP_ck").checked;var j=$("#client_IPAdrReserve").val();var a=$("#client_Name").val();var i=document.getElementById("enableAccess_ck").checked;var g=$("#schedule").val();$("#check_btn").attr("class","styled_button_dis").attr("disabled",true);var e=datalist.getData(b);e.NickName=a;if(h&&(j!="")){if(!COMM_ValidV4Format(j)||!COMM_ValidV4Addr(j)){document.getElementById("IPAdrReserve_Info").innerHTML=I18N("j","err_address_Check");return}else{e.ReserveIP=j}}else{e.ReserveIP=""}e.MacfilterEnabled=i;if(i){e.ScheduleName=g}else{e.ScheduleName=""}datalist.editData(e.rowid,e);var k=new SOAPAction();var d=new SOAPSetClientInfo();var c=new SOAPClientInfo();c.MacAddress=e.MacAddress;c.NickName=e.NickName;c.ReserveIP=e.ReserveIP;d.ClientInfoLists.push(c);var f=k.sendSOAPAction("SetClientInfo",d,null);f.done(function(q){if(q.SetClientInfoResult=="ERROR_RESERVEIP_CONFLICT"){alert(I18N("j","IP address cannot be the same."));$("#check_btn").attr("class","styled_button_s").attr("disabled",false)}else{var p=new SOAPAction();var n=new SOAPSetMACFilters2();for(var o in datalist.list){if(datalist.list[o].MacfilterEnabled){var m=new SOAPMacInfo();m.MacAddress=datalist.list[o].MacAddress;m.ScheduleName=encode_char_text(datalist.list[o].ScheduleName);n.MACList.push(m)}}var l=p.sendSOAPAction("SetMACFilters2",n,null);resetRulePOP()}})}function clearCreateRulePOP(){resetRulePOP()}function resetRulePOP(){Get_ClientInfo().done(function(){$("#editPop").hide();$("input").val("");$("select").selectbox("detach");$("#schedule").val("Always");$("select").selectbox("attach")})}function getClientList(a){if(a=="Host"){$("#client_btn_Blocked").attr("class","v4v6_linkstyle_2");$("#client_btn_Guest").attr("class","v4v6_linkstyle_2");$("#client_btn_Host").attr("class","v4v6_linkstyle_1")}else{if(a=="Guest"){$("#client_btn_Blocked").attr("class","v4v6_linkstyle_2");$("#client_btn_Guest").attr("class","v4v6_linkstyle_1");$("#client_btn_Host").attr("class","v4v6_linkstyle_2")}else{$("#client_btn_Blocked").attr("class","v4v6_linkstyle_1");$("#client_btn_Guest").attr("class","v4v6_linkstyle_2");$("#client_btn_Host").attr("class","v4v6_linkstyle_2")}}Client_Type=a;Get_ClientInfo()};